/**
 * main.js
 * http://www.codrops.com
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 *
 * Copyright 2015, Codrops
 * http://www.codrops.com
 */
!function(i){"use strict";function t(i,t){var e=!0;return function(n){e&&(e=!1,setTimeout(function(){e=!0},t),i(n))}}function e(i){for(var t=i.nextSibling;t&&1!=t.nodeType;)t=t.nextSibling;return t}function n(i,t){for(var e in t)t.hasOwnProperty(e)&&(i[e]=t[e]);return i}function s(i,t){this.gridEl=i,this.options=n({},this.options),n(this.options,t),this.items=[].slice.call(this.gridEl.querySelectorAll(".grid__item")),this.previewEl=e(this.gridEl),this.isExpanded=!1,this.isAnimating=!1,this.closeCtrl=this.previewEl.querySelector("button.action--close"),this.previewDescriptionEl=this.previewEl.querySelector(".description--preview"),this._init()}var o={transitions:Modernizr.csstransitions},r={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},a=r[Modernizr.prefixed("transition")],h=function(i,t){var e=function(i){if(o.transitions){if(i.target!=this)return;this.removeEventListener(a,e)}t&&"function"==typeof t&&t.call(this)};o.transitions?i.addEventListener(a,e):e()};s.prototype.options={pagemargin:0,imgPosition:{x:1,y:1},onInit:function(){return!1},onResize:function(){return!1},onOpenItem:function(){return!1},onCloseItem:function(){return!1},onExpand:function(){return!1}},s.prototype._init=function(){this.options.onInit(this);var i=this;imagesLoaded(this.gridEl,function(){new Masonry(i.gridEl,{itemSelector:".grid__item",isFitWidth:!0}),classie.add(i.gridEl,"grid--loaded"),i._initEvents(),i._setOriginal(),i._setClone()})},s.prototype._initEvents=function(){var e=this,n=null!==document.ontouchstart?"click":"touchstart";this.items.forEach(function(i){var t=function(n){n.preventDefault(),e._openItem(n,i),i.removeEventListener("touchend",t)},s=function(){i.removeEventListener("touchend",t)},o=function(){i.addEventListener("touchend",t),i.addEventListener("touchmove",s)};i.addEventListener(n,function(t){"click"===n?(t.preventDefault(),e._openItem(t,i)):o()})}),this.closeCtrl.addEventListener("click",function(){e._closeItem()}),i.addEventListener("resize",t(function(){e.options.onResize(e)},10))},s.prototype._openItem=function(i,t){if(!this.isAnimating&&!this.isExpanded){this.isAnimating=!0,this.isExpanded=!0;var e=t.querySelector("img"),n=e.getBoundingClientRect();this.current=this.items.indexOf(t),this._setOriginal(t.querySelector("a").getAttribute("href")),this.options.onOpenItem(this,t),this._setClone(e.src,{width:e.offsetWidth,height:e.offsetHeight,left:n.left,top:n.top}),classie.add(t,"grid__item--current");var s=this._getWinSize(),o=t.getAttribute("data-size").split("x"),r={width:o[0],height:o[1]},a=(this.options.imgPosition.x>0?1-Math.abs(this.options.imgPosition.x):Math.abs(this.options.imgPosition.x))*s.width+this.options.imgPosition.x*s.width/2-n.left-.5*e.offsetWidth,l=(this.options.imgPosition.y>0?1-Math.abs(this.options.imgPosition.y):Math.abs(this.options.imgPosition.y))*s.height+this.options.imgPosition.y*s.height/2-n.top-.5*e.offsetHeight,g=Math.min(Math.min(s.width*Math.abs(this.options.imgPosition.x)-this.options.pagemargin,r.width-this.options.pagemargin)/e.offsetWidth,Math.min(s.height*Math.abs(this.options.imgPosition.y)-this.options.pagemargin,r.height-this.options.pagemargin)/e.offsetHeight);this.cloneImg.style.WebkitTransform="translate3d("+a+"px, "+l+"px, 0) scale3d("+g+", "+g+", 1)",this.cloneImg.style.transform="translate3d("+a+"px, "+l+"px, 0) scale3d("+g+", "+g+", 1)";var c=t.querySelector(".description");c&&(this.previewDescriptionEl.innerHTML=c.innerHTML);var m=this;setTimeout(function(){classie.add(m.previewEl,"preview--open"),m.options.onExpand()},0),h(this.cloneImg,function(){imagesLoaded(m.originalImg,function(){classie.add(m.previewEl,"preview--image-loaded"),m.originalImg.style.opacity=1,h(m.originalImg,function(){m.cloneImg.style.opacity=0,m.cloneImg.style.WebkitTransform="translate3d(0,0,0) scale3d(1,1,1)",m.cloneImg.style.transform="translate3d(0,0,0) scale3d(1,1,1)",m.isAnimating=!1})})})}},s.prototype._setOriginal=function(i){i||(this.originalImg=document.createElement("img"),this.originalImg.className="original",this.originalImg.style.opacity=0,this.originalImg.style.maxWidth="calc("+parseInt(100*Math.abs(this.options.imgPosition.x))+"vw - "+this.options.pagemargin+"px)",this.originalImg.style.maxHeight="calc("+parseInt(100*Math.abs(this.options.imgPosition.y))+"vh - "+this.options.pagemargin+"px)",this.originalImg.style.WebkitTransform="translate3d(0,0,0) scale3d(1,1,1)",this.originalImg.style.transform="translate3d(0,0,0) scale3d(1,1,1)",i="",this.previewEl.appendChild(this.originalImg)),this.originalImg.setAttribute("src",i)},s.prototype._setClone=function(i,t){i?(this.cloneImg.style.opacity=1,this.cloneImg.style.width=t.width+"px",this.cloneImg.style.height=t.height+"px",this.cloneImg.style.top=t.top+"px",this.cloneImg.style.left=t.left+"px"):(this.cloneImg=document.createElement("img"),this.cloneImg.className="clone",i="",this.cloneImg.style.opacity=0,this.previewEl.appendChild(this.cloneImg)),this.cloneImg.setAttribute("src",i)},s.prototype._closeItem=function(){if(this.isExpanded&&!this.isAnimating){this.isExpanded=!1,this.isAnimating=!0;var i=this.items[this.current],t=i.querySelector("img"),e=t.getBoundingClientRect(),n=this;classie.remove(this.previewEl,"preview--open"),classie.remove(this.previewEl,"preview--image-loaded"),this.options.onCloseItem(this,i),classie.add(this.originalImg,"animate");var s=this._getWinSize(),o=e.left+t.offsetWidth/2-((this.options.imgPosition.x>0?1-Math.abs(this.options.imgPosition.x):Math.abs(this.options.imgPosition.x))*s.width+this.options.imgPosition.x*s.width/2),r=e.top+t.offsetHeight/2-((this.options.imgPosition.y>0?1-Math.abs(this.options.imgPosition.y):Math.abs(this.options.imgPosition.y))*s.height+this.options.imgPosition.y*s.height/2),a=t.offsetWidth/this.originalImg.offsetWidth;this.originalImg.style.WebkitTransform="translate3d("+o+"px, "+r+"px, 0) scale3d("+a+", "+a+", 1)",this.originalImg.style.transform="translate3d("+o+"px, "+r+"px, 0) scale3d("+a+", "+a+", 1)",h(this.originalImg,function(){n.previewDescriptionEl.innerHTML="",classie.remove(i,"grid__item--current"),setTimeout(function(){n.originalImg.style.opacity=0},60),h(n.originalImg,function(){classie.remove(n.originalImg,"animate"),n.originalImg.style.WebkitTransform="translate3d(0,0,0) scale3d(1,1,1)",n.originalImg.style.transform="translate3d(0,0,0) scale3d(1,1,1)",n.isAnimating=!1})})}},s.prototype._getWinSize=function(){return{width:document.documentElement.clientWidth,height:i.innerHeight}},i.GridFx=s}(window);